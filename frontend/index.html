<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astro Planner</title>
    <link rel="stylesheet" href="tron-theme.css">
    <link rel="stylesheet" href="css/unified-layout.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Mobile hamburger menu -->
        <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle menu">
            ‚ò∞
        </button>

        <!-- Left Sidebar (320px) -->
        <aside class="app-sidebar" id="app-sidebar">
            <div class="sidebar-content">
                <!-- Connection Panel (Always Visible) -->
                <div class="panel panel-connection" id="connection-panel">
                    <div class="panel-header">
                        <h3>Connection & Weather</h3>
                    </div>
                    <div class="panel-body">
                        <!-- Device Selection -->
                        <div class="form-group">
                            <label for="device-select">Device</label>
                            <select id="device-select" class="form-control">
                                <option value="">Select device...</option>
                            </select>
                        </div>

                        <!-- Connection Button -->
                        <button id="connect-btn" class="btn btn-primary" disabled>
                            Connect
                        </button>

                        <!-- Connection Status -->
                        <div class="connection-status" id="connection-status">
                            <span class="status-indicator disconnected"></span>
                            <span class="status-text">Disconnected</span>
                        </div>

                        <!-- Weather Conditions -->
                        <div class="weather-widget" id="weather-widget">
                            <div class="weather-header">
                                <span class="weather-icon">üå§Ô∏è</span>
                                <span class="weather-status">Loading weather...</span>
                            </div>
                            <div class="weather-details" id="weather-details">
                                <!-- Weather details populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Discovery Workflow Section -->
                <div class="workflow-section" id="discovery-section">
                    <div class="workflow-header" data-workflow="discovery">
                        <span class="workflow-title">DISCOVERY</span>
                        <span class="workflow-chevron">‚ñº</span>
                    </div>
                    <div class="workflow-content">
                        <!-- Catalog Search Panel -->
                        <div class="panel panel-collapsible" id="catalog-search-panel">
                            <div class="panel-header">
                                <h3>Catalog Search</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <!-- Search Box -->
                                <div class="form-group">
                                    <label for="catalog-search">Search</label>
                                    <div class="search-box">
                                        <input type="text" id="catalog-search" class="form-control" placeholder="Object name...">
                                        <button id="catalog-search-btn" class="btn btn-primary btn-sm">Search</button>
                                    </div>
                                </div>

                                <!-- Filters -->
                                <div class="form-group">
                                    <label for="filter-type">Type</label>
                                    <select id="filter-type" class="form-control">
                                        <option value="">All types</option>
                                        <option value="galaxy">Galaxy</option>
                                        <option value="nebula">Nebula</option>
                                        <option value="cluster">Cluster</option>
                                        <option value="planetary_nebula">Planetary Nebula</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="filter-constellation">Constellation</label>
                                    <select id="filter-constellation" class="form-control">
                                        <option value="">All constellations</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="filter-magnitude">Max Magnitude</label>
                                    <input type="number" id="filter-magnitude" class="form-control" placeholder="e.g. 12.0" step="0.1">
                                </div>

                                <!-- Sort -->
                                <div class="form-group">
                                    <label for="sort-by">Sort By</label>
                                    <select id="sort-by" class="form-control">
                                        <option value="name">Name</option>
                                        <option value="magnitude">Magnitude</option>
                                        <option value="type">Type</option>
                                    </select>
                                </div>

                                <!-- Actions -->
                                <button id="apply-filters-btn" class="btn btn-primary">Apply Filters</button>
                                <button id="clear-filters-btn" class="btn btn-secondary">Clear</button>
                            </div>
                        </div>

                        <!-- Custom Plan Builder Panel -->
                        <div class="panel panel-collapsible collapsed" id="custom-plan-panel">
                            <div class="panel-header">
                                <h3>Custom Plan Builder</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <p class="info-text">Select targets from catalog to build a custom observation plan.</p>
                                <div id="selected-targets-list">
                                    <p class="empty-state">No targets selected</p>
                                </div>
                                <button id="create-custom-plan-btn" class="btn btn-primary" disabled>Create Plan</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Planning Workflow Section -->
                <div class="workflow-section collapsed" id="planning-section">
                    <div class="workflow-header" data-workflow="planning">
                        <span class="workflow-title">PLANNING</span>
                        <span class="workflow-chevron">‚ñ∂</span>
                    </div>
                    <div class="workflow-content">
                        <!-- Location & Device Panel -->
                        <div class="panel panel-collapsible" id="location-device-panel">
                            <div class="panel-header">
                                <h3>Location & Device</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <!-- Location Inputs -->
                                <div class="form-group">
                                    <label for="plan-latitude">Latitude</label>
                                    <input type="number" id="plan-latitude" class="form-control" placeholder="e.g. 40.7128" step="0.0001">
                                </div>

                                <div class="form-group">
                                    <label for="plan-longitude">Longitude</label>
                                    <input type="number" id="plan-longitude" class="form-control" placeholder="e.g. -74.0060" step="0.0001">
                                </div>

                                <div class="form-group">
                                    <label for="plan-elevation">Elevation (m)</label>
                                    <input type="number" id="plan-elevation" class="form-control" placeholder="e.g. 10" step="1">
                                </div>

                                <!-- Device Selection -->
                                <div class="form-group">
                                    <label for="plan-device">Device</label>
                                    <select id="plan-device" class="form-control">
                                        <option value="">Select device...</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Observing Preferences Panel -->
                        <div class="panel panel-collapsible collapsed" id="observing-preferences-panel">
                            <div class="panel-header">
                                <h3>Observing Preferences</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <!-- Date/Time Selection -->
                                <div class="form-group">
                                    <label for="plan-date">Observation Date</label>
                                    <input type="date" id="plan-date" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label for="plan-start-time">Start Time</label>
                                    <input type="time" id="plan-start-time" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label for="plan-end-time">End Time</label>
                                    <input type="time" id="plan-end-time" class="form-control">
                                </div>

                                <!-- Constraints -->
                                <div class="form-group">
                                    <label for="min-altitude">Minimum Altitude (¬∞)</label>
                                    <input type="number" id="min-altitude" class="form-control" placeholder="e.g. 30" min="0" max="90" value="30">
                                </div>

                                <div class="form-group">
                                    <label for="max-moon-phase">Max Moon Illumination (%)</label>
                                    <input type="number" id="max-moon-phase" class="form-control" placeholder="e.g. 50" min="0" max="100" value="50">
                                </div>

                                <!-- Preference Toggles -->
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="avoid-moon" checked>
                                        <span>Avoid bright moon</span>
                                    </label>
                                </div>

                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="prioritize-transits">
                                        <span>Prioritize meridian transits</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Mosaic Planning Panel -->
                        <div class="panel panel-collapsible collapsed" id="mosaic-planning-panel">
                            <div class="panel-header">
                                <h3>Mosaic Planning</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <!-- Enable Mosaic -->
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="enable-mosaic">
                                        <span>Enable mosaic mode</span>
                                    </label>
                                </div>

                                <!-- Mosaic Configuration (hidden unless mosaic enabled) -->
                                <div id="mosaic-config" style="display: none;">
                                    <div class="form-group">
                                        <label for="mosaic-rows">Grid Rows</label>
                                        <input type="number" id="mosaic-rows" class="form-control" value="2" min="1" max="10">
                                    </div>

                                    <div class="form-group">
                                        <label for="mosaic-cols">Grid Columns</label>
                                        <input type="number" id="mosaic-cols" class="form-control" value="2" min="1" max="10">
                                    </div>

                                    <div class="form-group">
                                        <label for="mosaic-overlap">Overlap (%)</label>
                                        <input type="number" id="mosaic-overlap" class="form-control" value="20" min="0" max="50" step="5">
                                    </div>

                                    <!-- Mosaic Visualization Placeholder -->
                                    <div class="mosaic-visualization" id="mosaic-visualization">
                                        <div class="visualization-placeholder">
                                            <p>Mosaic pattern will be visualized here</p>
                                        </div>
                                    </div>

                                    <!-- Estimated Time -->
                                    <div class="form-group">
                                        <label>Estimated Total Time</label>
                                        <div class="info-display" id="mosaic-estimated-time">
                                            --:--:--
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Plan Results Panel -->
                        <div class="panel panel-collapsible collapsed" id="plan-results-panel">
                            <div class="panel-header">
                                <h3>Plan Results</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <!-- Generate Plan Button -->
                                <button id="generate-plan-btn" class="btn btn-primary">Generate Plan</button>

                                <!-- Plan Summary (hidden until plan generated) -->
                                <div id="plan-summary" style="display: none;">
                                    <div class="plan-summary-header">
                                        <h4>Observation Plan</h4>
                                        <span class="plan-date" id="plan-summary-date"></span>
                                    </div>

                                    <div class="plan-summary-body">
                                        <div class="plan-stat">
                                            <span class="plan-stat-label">Total Targets:</span>
                                            <span class="plan-stat-value" id="plan-total-targets">0</span>
                                        </div>

                                        <div class="plan-stat">
                                            <span class="plan-stat-label">Duration:</span>
                                            <span class="plan-stat-value" id="plan-duration">0h 0m</span>
                                        </div>

                                        <div class="plan-stat">
                                            <span class="plan-stat-label">Start Time:</span>
                                            <span class="plan-stat-value" id="plan-start">--:--</span>
                                        </div>

                                        <div class="plan-stat">
                                            <span class="plan-stat-label">End Time:</span>
                                            <span class="plan-stat-value" id="plan-end">--:--</span>
                                        </div>
                                    </div>

                                    <!-- Export Options -->
                                    <div class="plan-export-actions">
                                        <button class="btn btn-secondary btn-sm" id="export-pdf-btn">Export PDF</button>
                                        <button class="btn btn-secondary btn-sm" id="export-csv-btn">Export CSV</button>
                                        <button class="btn btn-secondary btn-sm" id="export-ical-btn">Export iCal</button>
                                    </div>

                                    <!-- Start Execution Button -->
                                    <button class="btn btn-primary" id="start-execution-btn">Start Execution</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Execution Workflow Section -->
                <div class="workflow-section collapsed" id="execution-section">
                    <div class="workflow-header" data-workflow="execution">
                        <span class="workflow-title">EXECUTION</span>
                        <span class="workflow-chevron">‚ñ∂</span>
                    </div>
                    <div class="workflow-content">
                        <p>Execution panels will go here</p>
                    </div>
                </div>

                <!-- Processing Workflow Section -->
                <div class="workflow-section collapsed" id="processing-section">
                    <div class="workflow-header" data-workflow="processing">
                        <span class="workflow-title">PROCESSING</span>
                        <span class="workflow-chevron">‚ñ∂</span>
                    </div>
                    <div class="workflow-content">
                        <p>Processing panels will go here</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="app-main" id="app-main">
            <div class="main-content" id="main-content">
                <!-- Catalog View (Discovery Context) -->
                <div class="catalog-view" id="catalog-view" style="display: block;">
                    <!-- Catalog Stats Banner -->
                    <div class="catalog-stats" id="catalog-stats">
                        <span class="stats-count">0 objects</span>
                        <span class="stats-filters" id="stats-filters"></span>
                    </div>

                    <!-- Catalog Grid -->
                    <div class="catalog-grid" id="catalog-grid">
                        <!-- Empty state -->
                        <div class="empty-state" id="catalog-empty-state">
                            <p>No objects found. Try adjusting your search or filters.</p>
                        </div>
                        <!-- Catalog cards will be inserted here by JavaScript -->
                    </div>

                    <!-- Pagination -->
                    <div class="catalog-pagination" id="catalog-pagination">
                        <button class="btn btn-secondary" id="prev-page-btn" disabled>Previous</button>
                        <span class="page-info" id="page-info">Page 1 of 1</span>
                        <button class="btn btn-secondary" id="next-page-btn" disabled>Next</button>
                    </div>
                </div>

                <!-- Planning View (Planning Context) -->
                <div class="planning-view" id="planning-view" style="display: none;">
                    <div class="view-placeholder">
                        <h2>Planning Results</h2>
                        <p>Plan generation results will appear here</p>
                    </div>
                </div>

                <!-- Execution View (Execution Context) -->
                <div class="execution-view" id="execution-view" style="display: none;">
                    <div class="view-placeholder">
                        <h2>Execution</h2>
                        <p>Telescope control and imaging will appear here</p>
                    </div>
                </div>

                <!-- Processing View (Processing Context) -->
                <div class="processing-view" id="processing-view" style="display: none;">
                    <div class="view-placeholder">
                        <h2>Processing</h2>
                        <p>Image processing workspace will appear here</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Drawer -->
        <div class="app-drawer" id="app-drawer">
            <button class="drawer-toggle" id="drawer-toggle">
                Advanced Controls
            </button>
            <div class="drawer-content" id="drawer-content">
                <div class="drawer-header">
                    <h3>Advanced Controls</h3>
                    <button class="settings-btn" id="settings-btn" aria-label="Settings">‚öôÔ∏è</button>
                </div>
                <div class="drawer-tabs" id="drawer-tabs">
                    <p>Drawer tabs will go here</p>
                </div>
            </div>
        </div>

        <!-- Mobile backdrop -->
        <div class="mobile-backdrop" id="mobile-backdrop"></div>
    </div>

    <!-- Scripts -->
    <script src="js/app-state.js"></script>
    <script src="js/app-context.js"></script>
    <script src="js/connection-manager.js"></script>
    <script src="js/weather-widget.js"></script>
    <script src="js/catalog-search.js"></script>
    <script src="js/planning-controls.js"></script>
</body>
</html>
