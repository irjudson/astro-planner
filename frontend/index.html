<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astro Planner</title>
    <link rel="stylesheet" href="tron-theme.css?v=7">
    <link rel="stylesheet" href="css/unified-layout.css?v=7">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Mobile hamburger menu -->
        <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle menu">
            ‚ò∞
        </button>

        <!-- Compact Status Bar (Full Width) -->
        <div class="status-bar">
            <!-- Connection Status -->
            <div class="status-item clickable" id="connection-status-compact" title="Click for details">
                <span class="status-indicator disconnected"></span>
                <span class="status-label">Disconnected</span>
                <button id="connect-btn-compact" class="btn-icon" disabled title="Connect">‚ö°</button>
            </div>

            <!-- Weather Status -->
            <div class="status-item clickable" id="weather-status-compact" title="Click for details">
                <span class="weather-icon">üå§Ô∏è</span>
                <span class="weather-label">Loading...</span>
            </div>
        </div>

        <!-- Left Sidebar (320px) -->
        <aside class="app-sidebar" id="app-sidebar">
            <div class="sidebar-content">
                <!-- Discovery Workflow Section -->
                <div class="workflow-section" id="discovery-section">
                    <div class="workflow-header" data-workflow="discovery">
                        <span class="workflow-title">DISCOVERY</span>
                        <span class="workflow-chevron">‚ñº</span>
                    </div>
                    <div class="workflow-content">
                        <!-- Catalog Search Panel -->
                        <div class="panel panel-collapsible" id="catalog-search-panel">
                            <div class="panel-header">
                                <h3>Catalog Search</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <!-- Search Box -->
                                <div class="form-group">
                                    <label for="catalog-search">Search</label>
                                    <div class="search-box">
                                        <input type="text" id="catalog-search" class="form-control" placeholder="Object name...">
                                        <button id="catalog-search-btn" class="btn btn-primary btn-sm">Search</button>
                                    </div>
                                </div>

                                <!-- Filters -->
                                <div class="form-group">
                                    <label for="filter-type">Type</label>
                                    <select id="filter-type" class="form-control">
                                        <option value="">All types</option>
                                        <option value="galaxy">Galaxy</option>
                                        <option value="nebula">Nebula</option>
                                        <option value="cluster">Cluster</option>
                                        <option value="planetary_nebula">Planetary Nebula</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="filter-constellation">Constellation</label>
                                    <select id="filter-constellation" class="form-control">
                                        <option value="">All constellations</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="filter-magnitude">Max Magnitude</label>
                                    <input type="number" id="filter-magnitude" class="form-control" placeholder="e.g. 12.0" step="0.1">
                                </div>

                                <!-- Sort -->
                                <div class="form-group">
                                    <label for="sort-by">Sort By</label>
                                    <select id="sort-by" class="form-control">
                                        <option value="name">Name</option>
                                        <option value="magnitude">Magnitude</option>
                                        <option value="type">Type</option>
                                    </select>
                                </div>

                                <!-- Actions -->
                                <button id="apply-filters-btn" class="btn btn-primary">Apply Filters</button>
                                <button id="clear-filters-btn" class="btn btn-secondary">Clear</button>
                            </div>
                        </div>

                        <!-- Custom Plan Builder Panel -->
                        <div class="panel panel-collapsible collapsed" id="custom-plan-panel">
                            <div class="panel-header">
                                <h3>Custom Plan Builder</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <p class="info-text">Select targets from catalog to build a custom observation plan.</p>
                                <div id="selected-targets-list">
                                    <p class="empty-state">No targets selected</p>
                                </div>
                                <button id="create-custom-plan-btn" class="btn btn-primary" disabled>Create Plan</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Planning Workflow Section -->
                <div class="workflow-section collapsed" id="planning-section">
                    <div class="workflow-header" data-workflow="planning">
                        <span class="workflow-title">PLANNING</span>
                        <span class="workflow-chevron">‚ñ∂</span>
                    </div>
                    <div class="workflow-content">
                        <!-- Location & Device Panel -->
                        <div class="panel panel-collapsible" id="location-device-panel">
                            <div class="panel-header">
                                <h3>Location & Device</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <!-- Location Inputs -->
                                <div class="form-group">
                                    <label for="plan-latitude">Latitude</label>
                                    <input type="number" id="plan-latitude" class="form-control" placeholder="e.g. 40.7128" step="0.0001">
                                </div>

                                <div class="form-group">
                                    <label for="plan-longitude">Longitude</label>
                                    <input type="number" id="plan-longitude" class="form-control" placeholder="e.g. -74.0060" step="0.0001">
                                </div>

                                <div class="form-group">
                                    <label for="plan-elevation">Elevation (m)</label>
                                    <input type="number" id="plan-elevation" class="form-control" placeholder="e.g. 10" step="1">
                                </div>

                                <!-- Device Selection -->
                                <div class="form-group">
                                    <label for="plan-device">Device</label>
                                    <select id="plan-device" class="form-control">
                                        <option value="">Select device...</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Observing Preferences Panel -->
                        <div class="panel panel-collapsible collapsed" id="observing-preferences-panel">
                            <div class="panel-header">
                                <h3>Observing Preferences</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <!-- Date/Time Selection -->
                                <div class="form-group">
                                    <label for="plan-date">Observation Date</label>
                                    <input type="date" id="plan-date" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label for="plan-start-time">Start Time</label>
                                    <input type="time" id="plan-start-time" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label for="plan-end-time">End Time</label>
                                    <input type="time" id="plan-end-time" class="form-control">
                                </div>

                                <!-- Constraints -->
                                <div class="form-group">
                                    <label for="min-altitude">Minimum Altitude (¬∞)</label>
                                    <input type="number" id="min-altitude" class="form-control" placeholder="e.g. 30" min="0" max="90" value="30">
                                </div>

                                <div class="form-group">
                                    <label for="max-moon-phase">Max Moon Illumination (%)</label>
                                    <input type="number" id="max-moon-phase" class="form-control" placeholder="e.g. 50" min="0" max="100" value="50">
                                </div>

                                <!-- Preference Toggles -->
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="avoid-moon" checked>
                                        <span>Avoid bright moon</span>
                                    </label>
                                </div>

                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="prioritize-transits">
                                        <span>Prioritize meridian transits</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Mosaic Planning Panel -->
                        <div class="panel panel-collapsible collapsed" id="mosaic-planning-panel">
                            <div class="panel-header">
                                <h3>Mosaic Planning</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <!-- Enable Mosaic -->
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="enable-mosaic">
                                        <span>Enable mosaic mode</span>
                                    </label>
                                </div>

                                <!-- Mosaic Configuration (hidden unless mosaic enabled) -->
                                <div id="mosaic-config" style="display: none;">
                                    <div class="form-group">
                                        <label for="mosaic-rows">Grid Rows</label>
                                        <input type="number" id="mosaic-rows" class="form-control" value="2" min="1" max="10">
                                    </div>

                                    <div class="form-group">
                                        <label for="mosaic-cols">Grid Columns</label>
                                        <input type="number" id="mosaic-cols" class="form-control" value="2" min="1" max="10">
                                    </div>

                                    <div class="form-group">
                                        <label for="mosaic-overlap">Overlap (%)</label>
                                        <input type="number" id="mosaic-overlap" class="form-control" value="20" min="0" max="50" step="5">
                                    </div>

                                    <!-- Mosaic Visualization Placeholder -->
                                    <div class="mosaic-visualization" id="mosaic-visualization">
                                        <div class="visualization-placeholder">
                                            <p>Mosaic pattern will be visualized here</p>
                                        </div>
                                    </div>

                                    <!-- Estimated Time -->
                                    <div class="form-group">
                                        <label>Estimated Total Time</label>
                                        <div class="info-display" id="mosaic-estimated-time">
                                            --:--:--
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Plan Results Panel -->
                        <div class="panel panel-collapsible collapsed" id="plan-results-panel">
                            <div class="panel-header">
                                <h3>Plan Results</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <!-- Generate Plan Button -->
                                <button id="generate-plan-btn" class="btn btn-primary">Generate Plan</button>

                                <!-- Plan Summary (hidden until plan generated) -->
                                <div id="plan-summary" style="display: none;">
                                    <div class="plan-summary-header">
                                        <h4>Observation Plan</h4>
                                        <span class="plan-date" id="plan-summary-date"></span>
                                    </div>

                                    <div class="plan-summary-body">
                                        <div class="plan-stat">
                                            <span class="plan-stat-label">Total Targets:</span>
                                            <span class="plan-stat-value" id="plan-total-targets">0</span>
                                        </div>

                                        <div class="plan-stat">
                                            <span class="plan-stat-label">Duration:</span>
                                            <span class="plan-stat-value" id="plan-duration">0h 0m</span>
                                        </div>

                                        <div class="plan-stat">
                                            <span class="plan-stat-label">Start Time:</span>
                                            <span class="plan-stat-value" id="plan-start">--:--</span>
                                        </div>

                                        <div class="plan-stat">
                                            <span class="plan-stat-label">End Time:</span>
                                            <span class="plan-stat-value" id="plan-end">--:--</span>
                                        </div>
                                    </div>

                                    <!-- Export Options -->
                                    <div class="plan-export-actions">
                                        <button class="btn btn-secondary btn-sm" id="export-pdf-btn">Export PDF</button>
                                        <button class="btn btn-secondary btn-sm" id="export-csv-btn">Export CSV</button>
                                        <button class="btn btn-secondary btn-sm" id="export-ical-btn">Export iCal</button>
                                    </div>

                                    <!-- Start Execution Button -->
                                    <button class="btn btn-primary" id="start-execution-btn">Start Execution</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Execution Workflow Section -->
                <div class="workflow-section collapsed" id="execution-section">
                    <div class="workflow-header" data-workflow="execution">
                        <span class="workflow-title">EXECUTION</span>
                        <span class="workflow-chevron">‚ñ∂</span>
                    </div>
                    <div class="workflow-content">
                        <!-- Execution Controls Panel -->
                        <div class="panel panel-collapsible" id="execution-controls-panel">
                            <div class="panel-header">
                                <h3>Execution Controls</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <div class="form-group">
                                    <label for="execution-target">Target</label>
                                    <select id="execution-target" class="form-control">
                                        <option value="">No target selected</option>
                                    </select>
                                </div>
                                <div class="execution-actions">
                                    <button id="start-execution-btn" class="btn btn-primary" disabled>Start</button>
                                    <button id="pause-execution-btn" class="btn btn-secondary" disabled>Pause</button>
                                    <button id="stop-execution-btn" class="btn btn-danger" disabled>Stop</button>
                                </div>
                                <div class="execution-progress" id="execution-progress" style="display: none;">
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="execution-progress-fill" style="width: 0%"></div>
                                    </div>
                                    <div class="progress-text" id="execution-progress-text">0 / 0 frames</div>
                                </div>
                            </div>
                        </div>

                        <!-- Imaging Panel -->
                        <div class="panel panel-collapsible collapsed" id="imaging-panel">
                            <div class="panel-header">
                                <h3>Imaging</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <div class="form-group">
                                    <label for="exposure-time">Exposure Time (s)</label>
                                    <input type="number" id="exposure-time" class="form-control" value="10" min="0.1" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="gain">Gain</label>
                                    <input type="number" id="gain" class="form-control" value="80" min="0" max="200">
                                </div>
                                <div class="form-group">
                                    <label for="frame-count">Frame Count</label>
                                    <input type="number" id="frame-count" class="form-control" value="50" min="1">
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="enable-dithering"> Enable Dithering
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Telescope Panel -->
                        <div class="panel panel-collapsible collapsed" id="telescope-panel">
                            <div class="panel-header">
                                <h3>Telescope</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <div class="telescope-coords">
                                    <div class="coord-group">
                                        <label>RA</label>
                                        <span id="telescope-ra" class="coord-value">--</span>
                                    </div>
                                    <div class="coord-group">
                                        <label>Dec</label>
                                        <span id="telescope-dec" class="coord-value">--</span>
                                    </div>
                                </div>
                                <div class="telescope-coords">
                                    <div class="coord-group">
                                        <label>Alt</label>
                                        <span id="telescope-alt" class="coord-value">--</span>
                                    </div>
                                    <div class="coord-group">
                                        <label>Az</label>
                                        <span id="telescope-az" class="coord-value">--</span>
                                    </div>
                                </div>
                                <div class="telescope-status">
                                    <label>Tracking:</label>
                                    <span id="tracking-status" class="status-value">Inactive</span>
                                </div>
                                <div class="form-group">
                                    <button id="goto-target-btn" class="btn btn-primary" disabled>Goto Target</button>
                                    <button id="park-telescope-btn" class="btn btn-secondary" disabled>Park</button>
                                </div>
                            </div>
                        </div>

                        <!-- Hardware Panel -->
                        <div class="panel panel-collapsible collapsed" id="hardware-panel">
                            <div class="panel-header">
                                <h3>Hardware</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <div class="hardware-status">
                                    <div class="status-row">
                                        <label>Temperature:</label>
                                        <span id="sensor-temp" class="status-value">--¬∞C</span>
                                    </div>
                                    <div class="status-row">
                                        <label>Dew Heater:</label>
                                        <span id="dew-heater-status" class="status-value">Off</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <button id="toggle-dew-heater-btn" class="btn btn-secondary" disabled>Toggle Dew Heater</button>
                                </div>
                            </div>
                        </div>

                        <!-- Info Panel -->
                        <div class="panel panel-collapsible collapsed" id="info-panel">
                            <div class="panel-header">
                                <h3>Session Info</h3>
                                <span class="panel-chevron">‚ñº</span>
                            </div>
                            <div class="panel-body">
                                <div class="session-stats">
                                    <div class="stat-row">
                                        <label>Session Time:</label>
                                        <span id="session-time">00:00:00</span>
                                    </div>
                                    <div class="stat-row">
                                        <label>Frames Captured:</label>
                                        <span id="frames-captured">0</span>
                                    </div>
                                    <div class="stat-row">
                                        <label>Total Exposure:</label>
                                        <span id="total-exposure">0s</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Processing Workflow Section -->
                <div class="workflow-section collapsed" id="processing-section">
                    <div class="workflow-header" data-workflow="processing">
                        <span class="workflow-title">PROCESSING</span>
                        <span class="workflow-chevron">‚ñ∂</span>
                    </div>
                    <div class="workflow-content">
                        <p>Processing panels will go here</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="app-main" id="app-main">
            <div class="main-content" id="main-content">
                <!-- Catalog View (Discovery Context) -->
                <div class="catalog-view" id="catalog-view" style="display: block;">
                    <!-- Catalog Stats Banner -->
                    <div class="catalog-stats" id="catalog-stats">
                        <span class="stats-count">0 objects</span>
                        <span class="stats-filters" id="stats-filters"></span>
                    </div>

                    <!-- Catalog Grid -->
                    <div class="catalog-grid" id="catalog-grid">
                        <!-- Empty state -->
                        <div class="empty-state" id="catalog-empty-state">
                            <p>No objects found. Try adjusting your search or filters.</p>
                        </div>
                        <!-- Catalog cards will be inserted here by JavaScript -->
                    </div>

                    <!-- Pagination -->
                    <div class="catalog-pagination" id="catalog-pagination">
                        <button class="btn btn-secondary" id="prev-page-btn" disabled>Previous</button>
                        <span class="page-info" id="page-info">Page 1 of 1</span>
                        <button class="btn btn-secondary" id="next-page-btn" disabled>Next</button>
                    </div>
                </div>

                <!-- Planning View (Planning Context) -->
                <div class="planning-view" id="planning-view" style="display: none;">
                    <div class="view-placeholder">
                        <h2>Planning Results</h2>
                        <p>Plan generation results will appear here</p>
                    </div>
                </div>

                <!-- Execution View (Execution Context) -->
                <div class="execution-view" id="execution-view" style="display: none;">
                    <div class="view-placeholder">
                        <h2>Execution</h2>
                        <p>Telescope control and imaging will appear here</p>
                    </div>
                </div>

                <!-- Processing View (Processing Context) -->
                <div class="processing-view" id="processing-view" style="display: none;">
                    <div class="view-placeholder">
                        <h2>Processing</h2>
                        <p>Image processing workspace will appear here</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Drawer -->
        <div class="app-drawer" id="app-drawer">
            <button class="drawer-toggle" id="drawer-toggle">
                Advanced Controls
            </button>
            <div class="drawer-content" id="drawer-content">
                <div class="drawer-header">
                    <h3>Advanced Controls</h3>
                    <button class="settings-btn" id="settings-btn" aria-label="Settings">‚öôÔ∏è</button>
                </div>
                <div class="drawer-tabs" id="drawer-tabs">
                    <p>Drawer tabs will go here</p>
                </div>
            </div>
        </div>

        <!-- Connection Modal -->
        <div class="modal" id="connection-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Device Connection</h2>
                    <button class="modal-close" id="connection-modal-close">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="connection-info">
                        <div class="info-row">
                            <label>Device:</label>
                            <span id="connection-device-name">None configured</span>
                        </div>
                        <div class="info-row">
                            <label>Status:</label>
                            <div class="status-inline">
                                <span class="status-indicator disconnected" id="connection-indicator-modal"></span>
                                <span class="status-text" id="connection-status-text-modal">Disconnected</span>
                            </div>
                        </div>
                    </div>
                    <div class="connection-messages" id="connection-messages">
                        <h4>Messages</h4>
                        <div class="message-list" id="connection-message-list">
                            <p class="empty-state">No messages</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="open-settings-btn" class="btn btn-secondary">Configure Device</button>
                    <button id="connect-btn" class="btn btn-primary" disabled>Connect</button>
                    <button id="disconnect-btn" class="btn btn-secondary" style="display: none;">Disconnect</button>
                </div>
            </div>
        </div>

        <!-- Weather Modal -->
        <div class="modal" id="weather-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Weather Conditions</h2>
                    <button class="modal-close" id="weather-modal-close">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="weather-current" id="weather-current">
                        <div class="weather-main">
                            <span class="weather-icon-large">üå§Ô∏è</span>
                            <div class="weather-temp">
                                <span id="weather-temp-value">--</span>¬∞C
                            </div>
                        </div>
                        <div class="weather-details-full">
                            <div class="weather-detail-row">
                                <label>Humidity:</label>
                                <span id="weather-humidity">--</span>%
                            </div>
                            <div class="weather-detail-row">
                                <label>Cloud Cover:</label>
                                <span id="weather-cloud-cover">--</span>%
                            </div>
                            <div class="weather-detail-row">
                                <label>Wind Speed:</label>
                                <span id="weather-wind-speed">--</span> km/h
                            </div>
                            <div class="weather-detail-row">
                                <label>Observability:</label>
                                <span id="weather-observability" class="observability-unknown">Unknown</span>
                            </div>
                        </div>
                    </div>
                    <div class="weather-forecast" id="weather-forecast">
                        <h4>Forecast</h4>
                        <div id="weather-forecast-list">
                            <!-- Forecast items will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="settings-modal" id="settings-modal" style="display: none;">
            <div class="settings-modal-content">
                <div class="settings-modal-header">
                    <h2>Settings</h2>
                    <button class="settings-modal-close" id="settings-modal-close">√ó</button>
                </div>
                <div class="settings-modal-body">
                    <div class="settings-section">
                        <h3>Device Configuration</h3>
                        <div class="form-group">
                            <label for="device-select">Default Device</label>
                            <select id="device-select" class="form-control">
                                <option value="">None configured</option>
                            </select>
                            <p class="form-help">Select the telescope device to use for observations</p>
                        </div>
                        <div class="form-group">
                            <button id="manage-devices-btn" class="btn btn-secondary">Manage Devices</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Display Preferences</h3>
                        <div class="form-group">
                            <label for="units-toggle">Units</label>
                            <select id="units-toggle" class="form-control">
                                <option value="metric">Metric (SI)</option>
                                <option value="imperial">Imperial (US)</option>
                            </select>
                            <p class="form-help">Choose between metric (¬∞C, km/h) and imperial (¬∞F, mph) units</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile backdrop -->
        <div class="mobile-backdrop" id="mobile-backdrop"></div>
    </div>

    <!-- Scripts -->
    <script src="js/app-state.js"></script>
    <script src="js/units.js"></script>
    <script src="js/app-context.js"></script>
    <script src="js/connection-manager.js"></script>
    <script src="js/weather-widget.js"></script>
    <script src="js/catalog-layout.js"></script>
    <script src="js/catalog-search.js"></script>
    <script src="js/planning-controls.js"></script>
    <script src="js/preferences.js"></script>
</body>
</html>
